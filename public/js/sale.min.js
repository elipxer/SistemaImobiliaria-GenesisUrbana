$(()=>{var e=$(".clientLineTable"),n=$(".clientLinePorc");function t(e){$.ajax({url:LOT_URL,type:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{idLot:e},dataType:"json",success:function(e){a(e.lot)},error:function(){alert("algo deu errado!")}})}function a(e){$("input[name=value]").val(e.present_value),$("input[name=input]").val(e.input),$("input[name=descont]").val(e.descont),$("input[name=future_value]").val(e.future_value)}function t(e){$.ajax({url:LOT_URL,type:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{idLot:e},dataType:"json",success:function(e){a(e.lot),function(){let e=$("#value").val(),n=$("input[name=input]").val(),t=$("input[name=descont]").val(),a=$("input[name=future_value]").val();$("input[name=value]").val(u(e,n,t,a)),$("input[name=value]").trigger("focus"),$("input[name=value]").trigger("blur"),s(u(e,n,t,a))}(),$("input[name=contract_number]").trigger("focus")},error:function(){alert("algo deu errado!")}})}function a(e){$("#value").val(e.present_value),null!=e.input?$("input[name=input]").val(e.input):$("input[name=input]").val("0,00"),null!=e.descont?$("input[name=descont]").val(e.descont):$("input[name=descont]").val("0,00"),null!=e.future_value?$("input[name=future_value]").val(e.future_value):$("input[name=future_value]").val("0,00")}$("input[name=expiration_day]").on("keyup",(function(){$(this).val()>31&&$(this).val(31)})),$("#clientName").on("keyup",(function(){let t=$(this).val();""!=t?($("#clientArea").fadeIn(),function(t){$.ajax({url:CLIENT_URL,type:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"JSON",data:{clientVal:t},success:function(t){!function(n){$("#clientAreaTable").find("tbody").empty();for(let t in n){let a=$(e).clone(!0);$(a).css("display","table-row"),$(a).find("td").eq(0).find("input").val(n[t].id);let l=n[t].name;2==n[t].kind_person&&(l=n[t].company_name),$(a).find("td").eq(1).html(l),$(a).find("td").eq(2).html(n[t].cpf),$(a).find("td").eq(3).html(n[t].cnpj),$(a).find("td").eq(4).html(n[t].rg),$(a).find("td").eq(5).html(n[t].email),$("#clientAreaTable").find("tbody").append(a),$("#clientAreaTable").find("input[name=clientCheck]").each((function(){$(this).on("change",(function(){let e=$(this).val();if($(this).prop("checked")){-1===$.inArray(e,i)&&i.push(e)}$("#id_clients").val(i)}))}))}}(t.clients),$("#clientAreaTable").find("input[name=clientCheck]").each((function(){$(this).on("change",(function(){!function(){$("#clientAreaTable").find("input[name=clientCheck]").each((function(){if($(this).prop("checked")){let e={id:$(this).val(),name:$(this).closest("tr").find("td").eq(1).html(),cpf:$(this).closest("tr").find("td").eq(2).html(),cnpj:$(this).closest("tr").find("td").eq(3).html()};-1===l.findIndex(n=>n.id===e.id)&&l.push(e)}})),$("#client_payment").empty(),l.forEach(e=>{let n="<option value='"+e.id+"'>Nome: "+e.name+"    Cpf/Cpnj:  "+e.cpf+"/"+e.cnpj+"</option>";$("#client_payment").append(n)}),l.length>0&&$("#client_payment_id").val(l[0].id);$("#client_payment").on("change",(function(){let e=$(this).find("option:selected").val();$("#client_payment_id").val(e)})),$("#card_porc").empty(),l.forEach(e=>{let t=n.clone();$(t).css("display","flex");let a="Nome: "+e.name+" Cpf/Cpnj"+e.cpf+"/"+e.cnpj;$(t).find(".nameClient").html(a),$(t).find(".idClient").val(e.id),$("#card_porc").append(t)}),r()}(),$(".porcValue").each((function(){$(this).on("keyup",(function(){""===$(this).val()&&$(this).val(0);let e=[];$("#card_porc").find(".clientLinePorc").each((function(){let n=parseFloat($(this).find(".porcValue").val()),t=$(this).find(".idClient").val()+"-"+n;e.push(t)})),$("#id_clients_porc").val(e)}))})),o()}))}))}})}(t)):$("#clientArea").fadeOut()})),$("input[name=interpriseCheck]").each((function(){$(this).on("change",(function(){if($(this).prop("checked")){$("#id_interprise").val($(this).val());let e=$(this).next("input[name=lotCheck]").val();t(e),$("#id_lot").val(e);let n=$(this).closest("tr").find("td").eq(2).html();$("#lot_number_input").html(n),$("input[name=parcels]").attr("readOnly",!1)}}))})),$("input[name=interpriseCheck]").each((function(){$(this).on("change",(function(){if($(this).prop("checked")){$("#id_interprise").val($(this).val());let e=$(this).next("input[name=lotCheck]").val();t(e),$("#id_lot").val(e);let n=$(this).closest("tr").find("td").eq(2).html();$("#lot_number_input").html(n)}}))})),$("input[name=parcels]").on("keyup",(function(){s(u($("#value").val(),$("input[name=input]").val(),$("input[name=descont]").val(),$("input[name=future_value]").val()))})),$("#addSale").on("click",(function(){0==function(){let e=!1;return $("input[name=interpriseCheck]").each((function(){$(this).prop("checked")&&(e=!0)})),e}()?Swal.fire({icon:"error",text:"Selecione um lot!",customClass:"mySweetalert"}):!1===function(){let e=!1;return $("#clientAreaTable").find("input[name=clientCheck]").each((function(){$(this).prop("checked")&&(e=!0)})),e}()?Swal.fire({icon:"error",text:"Selecione pelo menos um cliente!",customClass:"mySweetalert"}):!1===function(){let e=0;return $("#card_porc").find(".clientLinePorc").each((function(){let n=parseFloat($(this).find(".porcValue").val());e+=n})),100==e}()?Swal.fire({icon:"error",text:"As soma das porcentagens do cliente não está dando 100%!",customClass:"mySweetalert"}):!1===function(){let e=!0,n=$("input[name=contract_number]").val(),t=$("input[name=input_value]").val(),a=$("input[name=expiration_day]").val(),i=$("input[name=first_parcel]").val(),l=$("input[name=parcels]").val(),c=$("input[name=value_parcel]").val(),o=$("input[name=annual_rate]").val();""!==n&&""!==t&&""!==a&&""!==i&&""!==l&&0!==l&&""!==c&&""!==o||(e=!1);return e}()?Swal.fire({icon:"error",text:"Preencha os campos obrigatórios da venda!",customClass:"mySweetalert"}):!function(){let e=!1,n=$("input[name=contract_number]").val();return $.ajax({url:VERIFY_CONTRACT_URL,type:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"JSON",data:{contract_number:n},async:!1,success:function(n){-1!=n&&(e=!0)}}),e}()?$("#formSale").trigger("submit"):Swal.fire({icon:"error",text:"Esse número de contrato ja está sendo utilizado!",customClass:"mySweetalert"})}));var i=[];var l=[];var c=$(".chooseClientRow");function o(){$("#card_chooseClients").empty(),l.forEach(e=>{let n=c.clone();$(n).css("display","flex"),$(n).find("input").val(e.id),$(n).find("div").eq(0).html(e.name);let t="Cpf/Cpnj "+e.cpf+"/"+e.cnpj;$(n).find("div").eq(1).html(t),$("#card_chooseClients").append(n)}),function(){let e=$("#card_chooseClients").find(".btnDelete-chooseClientRow");$(e).each((function(){$(this).on("click",(function(){let e=$(this).closest(".chooseClientRow").find("input").val(),t=l.findIndex((function(n){if(n.id===e)return!0}));l.splice(t,1),o(),$("#client_payment").empty(),l.forEach(e=>{let n="<option value='"+e.id+"'>Nome: "+e.name+"    Cpf/Cpnj:  "+e.cpf+"/"+e.cnpj+"</option>";$("#client_payment").append(n)}),l.length>0&&$("#client_payment_id").val(l[0].id),$("#client_payment").on("change",(function(){let e=$(this).find("option:selected").val();$("#client_payment_id").val(e)})),$("#card_porc").empty();let a=[];l.forEach(e=>{let t=n.clone();$(t).css("display","flex");let i="Nome: "+e.name+" Cpf/Cpnj"+e.cpf+"/"+e.cnpj;$(t).find(".nameClient").html(i),$(t).find(".idClient").val(e.id),$("#card_porc").append(t),a.push(e.id)}),r(),$("#id_clients").val(a.join(",")),i=a,$("#clientAreaTable").find("tbody").empty(),$("#clientName").val("")}))}))}()}function r(){let e=$("#card_porc").find(".clientLinePorc").length,n=100/parseInt(e);$("#card_porc").find(".clientLinePorc").each((function(){$(this).find(".porcValue").val(n.toFixed(2))}));let t=[];$("#card_porc").find(".clientLinePorc").each((function(){let e=parseFloat($(this).find(".porcValue").val()),n=$(this).find(".idClient").val()+"-"+e;t.push(n)})),$("#id_clients_porc").val(t)}function u(e=null,n=null,t=null,a=null){return e=p(e),n=p(n),t=p(t),(a=p(a))-n-t}function p(e){return e=(e=(e=e.replace("R$","")).replace(".","")).replace(",","."),parseFloat(e).toFixed(2)}function s(e){let n=parseInt($("#parcels").val());$("#parcels").val()<=0&&(n=1);let t=e/n;$("#value_parcel").val(t.toFixed(2)),$("#value_parcel").trigger("focus"),$("#parcels").trigger("focus")}});