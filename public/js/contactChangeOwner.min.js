$(()=>{var e=$("#clientSearchArea"),t=$(".clientLineTable"),n=[],i=[],l=$("#tableOwner").find(".tableOwneLine").eq(0);function a(){$("#tableOwner").find("tbody").empty();let e=[];i.forEach(t=>{let n=$(l).clone();$(n).prop("id",t.idClient),$(n).find("td").eq(0).html(t.name),$(n).find("td").eq(1).html(t.cpfCnpj),$("#tableOwner").find("tbody").append(n),e.push(t.idClient)}),$("#clients").val(e),$("#client_payment").empty(),i.forEach(e=>{let t="<option value='"+e.idClient+"'>Nome: "+e.name+";      Cpf/Cpnj:  "+e.cpfCnpj+"</option>";e.idClient===parseInt($("#client_payment").val())&&$(t).prop("selected",!0),$("#client_payment").append(t)}),function(){let e=i.length,t=100/parseInt(e);$("#tableOwner").find("tbody tr").each((function(){$(this).find(".porcValue").val(t)}));let n=[];$("#tableOwner").find("tbody tr").each((function(){let e=parseFloat($(this).find(".porcValue").val()),t=$(this).attr("id")+"-"+e;n.push(t)})),$("#id_clients_porc").val(n)}()}$("#tableOwner").find(".tableOwneLine").each((function(){let e=$(this).attr("id"),t=$(this).find("td").eq(0).html(),n=$(this).find("td").eq(1).html();var l={idClient:e,name:t.trim(),cpfCnpj:n.trim()};i.push(l)})),$("#btnAddClient").on("click",(function(){$(e).show(),$("#btnAddModal").off(),$("#btnEditModal").off(),$("#modalAcoes").find(".modal-body").empty(),$("#modalAcoes").find(".modal-body").append(e),$("#btnEditModal").hide(),$("#btnAddModal").show(),$("#modalAcoes").find(".modal-dialog").css("max-width",700),$("#modalAcoes").find(".modal-title").html("Adicionar Cliente a Venda"),$("#btnAddModal").on("click",(function(e){a(),$("#modalAcoes").hide(),$("#close").trigger("click"),$("#clientAreaTable").find("tbody").empty()})),$("#clientName").val(""),$("#clientName").on("keyup",(function(){let e=$(this).val();""!=e?function(e){$.ajax({url:CLIENT_URL,type:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"JSON",data:{clientVal:e},success:function(e){!function(e){$("#clientAreaTable").find("tbody").empty();for(let n in e){let l=$(t).clone(!0);$(l).css("display","table-row"),$(l).find("td").eq(0).find("input").val(e[n].id);let a=e[n].name;null===e[n].name&&(a=e[n].company_name),$(l).find("td").eq(1).html(a);let d="";d=null!=e[n].cpf?e[n].cpf:e[n].cnpj,$(l).find("td").eq(2).html(d),$(l).find("td").eq(3).html(e[n].email),-1==i.findIndex(t=>parseInt(t.idClient)==e[n].id)&&$("#clientAreaTable").find("tbody").append(l)}$("#clientAreaTable").find("input[name=clientCheck]").each((function(){$(this).on("change",(function(){if($(this).prop("checked")){var e={idClient:$(this).val(),name:$(this).closest("tr").find("td").eq(1).html(),cpfCnpj:$(this).closest("tr").find("td").eq(2).html()};i.push(e)}}))}))}(e.clients)}})}(e):$("#clientAreaTable").find("tbody").empty()}))})),$("#tableOwner").find(".tableOwneLine").find(".btnDeleteClient").each((function(){$(this).on("click",(function(){let e=$(this).attr("id"),t=(i=i.concat(n)).findIndex(t=>parseInt(t.idClient)==e);i.splice(t,1),a(),$("#clients").val(i.map((function(e){return e.idClient})))}))})),$("#btnInput").on("click",(function(e){e.preventDefault(),!1===function(){let e=0;return $("#tableOwner").find("tbody tr").each((function(){let t=parseFloat($(this).find(".porcValue").val());e+=t})),100==e}()?Swal.fire({icon:"error",text:"As soma das porcentagens do cliente não está dando 100%!",customClass:"mySweetalert"}):$("#changeOwnerForm").trigger("submit")}))});